<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ³¡å¥¶æ°´æº«æ··åˆè¨ˆç®—å™¨</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --warning: #F5A623;
            --danger: #E74C3C;
            --bg: #F4F6F8;
            --card: #FFFFFF;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: var(--card);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        h1 {
            font-size: 1.25rem;
            text-align: center;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        .section-title {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 10px;
            font-weight: 600;
        }
        .input-group {
            margin-bottom: 16px;
        }
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
        }
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .row {
            display: flex;
            gap: 12px;
        }
        .col {
            flex: 1;
        }
        .mode-switch {
            background: #f0f0f0;
            padding: 4px;
            border-radius: 8px;
            display: flex;
            margin-bottom: 20px;
        }
        .mode-btn {
            flex: 1;
            padding: 10px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .mode-btn.active {
            background: #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-weight: bold;
            color: var(--primary);
        }
        .quick-chips {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            flex-wrap: wrap;
        }
        .chip {
            padding: 6px 12px;
            background: #eef2f7;
            border-radius: 20px;
            font-size: 0.8rem;
            color: var(--primary);
            cursor: pointer;
        }
        button.calc-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
        #result-card {
            margin-top: 24px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
            display: none;
        }
        .result-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        .water-block {
            text-align: center;
            flex: 1;
        }
        .water-val {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        .water-label {
            font-size: 0.8rem;
            color: #666;
        }
        .plus {
            font-size: 1.2rem;
            color: #999;
            margin: 0 10px;
        }
        .steps {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #444;
        }
        .steps li {
            margin-bottom: 6px;
        }
        .disclaimer {
            margin-top: 30px;
            font-size: 0.75rem;
            color: #999;
            text-align: center;
            line-height: 1.4;
        }
        .mode-desc {
            font-size: 0.8rem;
            color: #666;
            margin-top: -15px;
            margin-bottom: 15px;
            padding: 0 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ¼ æ³¡å¥¶æ°´æº«è¨ˆç®—å™¨</h1>

    <div class="mode-switch">
        <div class="mode-btn active" onclick="setMode('A')">æ¨¡å¼ A (å®‰å…¨)</div>
        <div class="mode-btn" onclick="setMode('B')">æ¨¡å¼ B (å¿«é€Ÿ)</div>
    </div>
    <div id="mode-desc" class="mode-desc">
        âš ï¸ å»ºè­°æ¨¡å¼ï¼šæ··åˆè‡³ 70Â°C æ®ºèŒï¼Œå†å†·å»è‡³é¤µé£Ÿæº«åº¦ã€‚
    </div>

    <div class="section-title">ç›®æ¨™è¨­å®š</div>
    <div class="row">
        <div class="col input-group">
            <label>ç¸½æ°´é‡ (ml)</label>
            <input type="number" id="targetVol" value="180">
            <div class="quick-chips">
                <span class="chip" onclick="setVal('targetVol', 120)">120</span>
                <span class="chip" onclick="setVal('targetVol', 150)">150</span>
                <span class="chip" onclick="setVal('targetVol', 180)">180</span>
            </div>
        </div>
        <div class="col input-group">
            <label>é¤µé£Ÿæº«åº¦ (Â°C)</label>
            <input type="number" id="targetTemp" value="45">
            <div class="quick-chips">
                <span class="chip" onclick="setVal('targetTemp', 40)">40</span>
                <span class="chip" onclick="setVal('targetTemp', 45)">45</span>
                <span class="chip" onclick="setVal('targetTemp', 50)">50</span>
            </div>
        </div>
    </div>

    <hr style="border:0; border-top:1px solid #eee; margin: 10px 0 20px;">

    <div class="section-title">é£²æ°´æ©Ÿæº«åº¦ (å¯æ‰‹å‹•ä¿®æ”¹)</div>
    <div class="row">
        <div class="col input-group">
            <label>ç†±æ°´ ğŸ”¥</label>
            <input type="number" id="tempHot" value="98">
        </div>
        <div class="col input-group">
            <label>æº«æ°´ â˜€ï¸</label>
            <input type="number" id="tempWarm" value="60">
        </div>
        <div class="col input-group">
            <label>å†·æ°´ â„ï¸</label>
            <input type="number" id="tempCold" value="20">
        </div>
    </div>

    <button class="calc-btn" onclick="calculate()">é–‹å§‹è¨ˆç®—</button>

    <div id="result-card">
        <div class="section-title" style="text-align:center; color: var(--primary)">å»ºè­°é…æ–¹</div>
        <div class="result-main">
            <div class="water-block">
                <div class="water-val" id="res-vol1">0</div>
                <div class="water-label" id="res-name1">ç†±æ°´</div>
                <div class="water-label" style="font-size:0.7rem" id="res-temp1">(98Â°C)</div>
            </div>
            <div class="plus">+</div>
            <div class="water-block">
                <div class="water-val" id="res-vol2">0</div>
                <div class="water-label" id="res-name2">å†·æ°´</div>
                <div class="water-label" style="font-size:0.7rem" id="res-temp2">(20Â°C)</div>
            </div>
        </div>
        <div style="text-align:center; margin-bottom:15px; font-weight:bold; color:#555">
            æ··åˆå¾Œç´„ï¼š<span id="final-temp-display">--</span>Â°C
        </div>
        <div class="section-title">æ“ä½œæ­¥é©Ÿ</div>
        <ol class="steps" id="step-list">
            </ol>
    </div>

    <div class="disclaimer">
        å…è²¬è²æ˜ï¼šæœ¬å·¥å…·åƒ…é€²è¡Œç‰©ç†ç†±å¹³è¡¡è¨ˆç®—ï¼Œä¸ä»£è¡¨é†«ç™‚å»ºè­°ã€‚è«‹å‹™å¿…ä¾å¥¶ç²‰ç½æŒ‡ç¤ºç¢ºèªæ¿ƒåº¦ï¼Œä¸¦åœ¨é¤µé£Ÿå‰æ»´åœ¨æ‰‹è…•å…§å´ç¢ºèªæº«åº¦ [cite: 8, 28]ã€‚
    </div>
</div>

<script>
    let currentMode = 'A'; // A=Safety, B=Direct

    function setVal(id, val) {
        document.getElementById(id).value = val;
    }

    function setMode(mode) {
        currentMode = mode;
        const btns = document.querySelectorAll('.mode-btn');
        btns.forEach(b => b.classList.remove('active'));
        // ç°¡å–®é€éæ–‡å­—å…§å®¹æ‰¾æŒ‰éˆ•åŠ æ¨£å¼ (æˆ–ä¾é»æ“Šäº‹ä»¶è™•ç†)
        if(mode === 'A') btns[0].classList.add('active');
        else btns[1].classList.add('active');
        
        const desc = document.getElementById('mode-desc');
        if (mode === 'A') {
            desc.innerHTML = 'âš ï¸ å»ºè­°æ¨¡å¼ï¼šæ··åˆè‡³ <strong>70Â°C</strong> æ®ºèŒï¼Œå†å†·å»è‡³é¤µé£Ÿæº«åº¦ã€‚';
        } else {
            desc.innerHTML = 'âš¡ å¿«é€Ÿæ¨¡å¼ï¼šç›´æ¥æ··åˆè‡³ç›®æ¨™æº«åº¦ï¼ˆé©åˆç¢ºèªæ°´æºå®‰å…¨æ™‚ä½¿ç”¨ï¼‰ã€‚';
        }
    }

    // æ–°å¢ï¼š10ml å–æ•´å‡½æ•¸
    function roundToStep(value, step = 10) {
        return Math.round(value / step) * step;
    }

    function calculate() {
        // 1. ç²å–è¼¸å…¥
        const Vt = parseFloat(document.getElementById('targetVol').value);
        const feedTemp = parseFloat(document.getElementById('targetTemp').value);
        
        const Th = parseFloat(document.getElementById('tempHot').value);
        const Tw = parseFloat(document.getElementById('tempWarm').value);
        const Tc = parseFloat(document.getElementById('tempCold').value);

        // 2. æ±ºå®šè¨ˆç®—ç›®æ¨™æº«åº¦ (Tt)
        let Tt = (currentMode === 'A') ? 70 : feedTemp;
        if (currentMode === 'A' && feedTemp > 70) Tt = feedTemp;

        // 3. å°‹æ‰¾æœ€ä½³å…©æ°´æºçµ„åˆ
        const sources = [
            { name: "ç†±æ°´", temp: Th },
            { name: "æº«æ°´", temp: Tw },
            { name: "å†·æ°´", temp: Tc }
        ];

        if (Tt > Th || Tt < Tc) {
            alert("ç›®æ¨™æº«åº¦ç„¡æ³•é”æˆï¼šè¶…å‡ºæ°´æºæº«åº¦ç¯„åœ");
            return;
        }

        let s1, s2;
        // å„ªå…ˆé †åºï¼šç†±+æº« -> æº«+å†· -> ç†±+å†·
        if (Tt <= Th && Tt >= Tw) {
            s1 = sources[0]; s2 = sources[1];
        } else if (Tt < Tw && Tt >= Tc) {
            s1 = sources[1]; s2 = sources[2];
        } else {
            s1 = sources[0]; s2 = sources[2];
        }

        // 4. ç†±å¹³è¡¡å…¬å¼ (ç†æƒ³å€¼)
        // V1_ideal = Vt * (Tt - T2) / (T1 - T2)
        let v1_ideal = Vt * (Tt - s2.temp) / (s1.temp - s2.temp);

        // 5. ã€é—œéµä¿®æ”¹ã€‘ä»¥ 10ml ç‚ºå–®ä½é€²è¡Œå››æ¨äº”å…¥
        let v1 = roundToStep(v1_ideal, 10);
        
        // é‚Šç•Œæª¢æŸ¥ï¼šä¸èƒ½å°æ–¼0æˆ–å¤§æ–¼ç¸½é‡
        if (v1 < 0) v1 = 0;
        if (v1 > Vt) v1 = Vt;

        let v2 = Vt - v1; // ç¢ºä¿ç¸½é‡å›ºå®šç‚º Vt

        // 6. åæ¨å¯¦éš›æº«åº¦ (å› ç‚ºæ°´é‡è¢«å››æ¨äº”å…¥éï¼Œæº«åº¦æœƒæœ‰åå·®)
        // T_final = (V1*T1 + V2*T2) / Vt
        let actualTemp = (v1 * s1.temp + v2 * s2.temp) / Vt;
        
        // ç‚ºäº†é¡¯ç¤ºç¾è§€ï¼Œå¯¦éš›æº«åº¦å–å°æ•¸é»å¾Œ1ä½
        actualTemp = Math.round(actualTemp * 10) / 10;
        let tempDiff = (actualTemp - Tt).toFixed(1);
        let diffSign = tempDiff > 0 ? "+" : "";

        // 7. æ¸²æŸ“çµæœ
        document.getElementById('result-card').style.display = 'block';
        
        // é¡¯ç¤ºæ°´é‡
        document.getElementById('res-name1').innerText = s1.name;
        document.getElementById('res-temp1').innerText = `(${s1.temp}Â°C)`;
        document.getElementById('res-vol1').innerText = v1 + " ml";

        document.getElementById('res-name2').innerText = s2.name;
        document.getElementById('res-temp2').innerText = `(${s2.temp}Â°C)`;
        document.getElementById('res-vol2').innerText = v2 + " ml";

        // é¡¯ç¤ºæº«åº¦çµæœèˆ‡èª¤å·®
        const tempDisplay = document.getElementById('final-temp-display');
        tempDisplay.innerText = actualTemp;
        
        // æ ¹æ“šèª¤å·®æ”¹è®Šé¡è‰²æç¤º
        const diffHtml = Math.abs(tempDiff) > 2 
            ? `<span style="color:var(--danger); font-size:0.8rem"> (èˆ‡ç›®æ¨™å·® ${diffSign}${tempDiff}Â°C)</span>`
            : `<span style="color:var(--success); font-size:0.8rem"> (èª¤å·® ${diffSign}${tempDiff}Â°C OK)</span>`;
            
        // é€™è£¡æˆ‘å€‘ç›´æ¥æ’å…¥ä¸€å€‹ span ä¾†é¡¯ç¤ºèª¤å·®
        // æ³¨æ„ï¼šéœ€ç¢ºä¿ HTML ä¸­ id="final-temp-display" çš„çˆ¶å…ƒç´ çµæ§‹é©åˆ
        tempDisplay.innerHTML = `${actualTemp} <span style="font-size:1rem; color:#333">Â°C</span> ${diffHtml}`;

        // 8. ç”Ÿæˆæ­¥é©Ÿ
        const list = document.getElementById('step-list');
        list.innerHTML = '';
        
        list.innerHTML += `<li>å…ˆå€’å…¥ <strong>${v1} ml</strong> çš„${s1.name}ã€‚</li>`;
        list.innerHTML += `<li>å†åŠ å…¥ <strong>${v2} ml</strong> çš„${s2.name}ã€‚</li>`;
        
        if (currentMode === 'A') {
            list.innerHTML += `<li>åŠ å…¥å¥¶ç²‰æ–å‹»ï¼Œç›®å‰æ°´æº«ç´„ <strong>${actualTemp}Â°C</strong> (æ®ºèŒç”¨)ã€‚</li>`;
            list.innerHTML += `<li style="color:var(--danger)">âš ï¸ <strong>å†·å»é™æº«</strong>ï¼šè«‹é™è‡³é¤µé£Ÿæº«åº¦ (${feedTemp}Â°C)ã€‚</li>`;
        } else {
            list.innerHTML += `<li>åŠ å…¥å¥¶ç²‰æ–å‹»ï¼Œç›®å‰æ°´æº«ç´„ <strong>${actualTemp}Â°C</strong>ï¼Œç¢ºèªä¸ç‡™å£å¾Œå³å¯é¤µé£Ÿã€‚</li>`;
        }
        
        list.innerHTML += `<li style="font-size:0.8rem; color:#999">å·²å°‡æ°´é‡èª¿æ•´ç‚º 10ml å€æ•¸ä»¥ä¾¿ä½¿ç”¨å¥¶ç“¶é‡æ¸¬ã€‚</li>`;
    }
</script>

</body>
</html>
